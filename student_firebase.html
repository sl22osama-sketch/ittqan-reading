<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„Ø¥ØªÙ‚Ø§Ù† Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© â€“ Ø§Ù„Ø·Ø§Ù„Ø¨</title>

<!-- ØªØµÙ…ÙŠÙ… Ø¨Ø³ÙŠØ· -->
<style>
body {
    font-family: "Tajawal", sans-serif;
    background: #f4f4ff;
    direction: rtl;
    text-align: center;
    padding: 20px;
}

h1 { color: #4b2cc4; }

button {
    padding: 10px 18px;
    margin: 6px;
    border: none;
    background: #5c3dff;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}

button:hover { background: #4327c2; }

.level-box button { background: #6c4bff; }
.level-box button:hover { background: #5237d1; }

#readingBox {
    width: 90%;
    margin: 20px auto;
    padding: 15px;
    background: white;
    border-radius: 12px;
    font-size: 26px;
    line-height: 42px;
    min-height: 140px;
}

.highlight {
    background: yellow;
    padding: 3px;
}
</style>

<!-- MP3 Encoder -->
<script src="https://unpkg.com/lamejs@1.2.0/lame.min.js"></script>

<!-- Shared logic (Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ) -->
<script src="shared.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<!-- Firebase config -->
<script src="firebase-config.js"></script>

<!-- Firebase shared -->
<script src="shared_firebase.js"></script>
</head>

<body>

<h1>ğŸ“˜ Ù…Ù†ØµØ© Ø§Ù„Ø·Ø§Ù„Ø¨</h1>

<label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
<input id="studentName"><br>

<label>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</label>
<input id="studentSchool"><br>

<label>Ø§Ù„ØµÙ:</label>
<select id="studentGrade">
  <option value="Ø§Ù„Ø£ÙˆÙ„">Ø§Ù„Ø£ÙˆÙ„</option>
  <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
  <option value="Ø§Ù„Ø«Ø§Ù„Ø«">Ø§Ù„Ø«Ø§Ù„Ø«</option>
  <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹">Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
  <option value="Ø§Ù„Ø®Ø§Ù…Ø³">Ø§Ù„Ø®Ø§Ù…Ø³</option>
  <option value="Ø§Ù„Ø³Ø§Ø¯Ø³">Ø§Ù„Ø³Ø§Ø¯Ø³</option>
  <option value="Ø§Ù„Ø³Ø§Ø¨Ø¹">Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
  <option value="Ø§Ù„Ø«Ø§Ù…Ù†">Ø§Ù„Ø«Ø§Ù…Ù†</option>
  <option value="Ø§Ù„ØªØ§Ø³Ø¹">Ø§Ù„ØªØ§Ø³Ø¹</option>
</select>
<br><br>

<div class="level-box">
    <button onclick="changeText(0)">Ù†Øµ 1</button>
    <button onclick="changeText(1)">Ù†Øµ 2</button>
    <button onclick="changeText(2)">Ù†Øµ 3</button>
</div>

<div id="readingBox"></div>

<button onclick="startReading()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
<button onclick="stopReading()">Ø£ÙˆÙ‚Ù Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
<button onclick="saveSession()">Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© + ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

<script>
// ---------------- Ø§Ù„Ù†ØµÙˆØµ ----------------
let texts = [
"Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„: Ø°Ù‡Ø¨ Ø®Ø§Ù„Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©...",
"Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙŠ: ÙÙŠ ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø£ÙŠØ§Ù… Ø®Ø±Ø¬Øª Ø³Ù…ÙŠØ±Ø©...",
"Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù„Ø«: ÙƒØ§Ù† ÙŠØ§ Ù…Ø§ ÙƒØ§Ù† ÙÙŠ Ù‚Ø¯ÙŠÙ… Ø§Ù„Ø²Ù…Ø§Ù†..."
];

let words = [];
let index = 0;
let startTime = 0;
let reading = false;

// ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ
function changeText(i) {
    index = 0;
    words = texts[i].split(" ");
    render();
}

function render() {
    let html = "";
    for (let i = 0; i < words.length; i++) {
        if (i === index) html += "<span class='highlight'>" + words[i] + "</span> ";
        else html += words[i] + " ";
    }
    document.getElementById("readingBox").innerHTML = html;
}

function startReading() {
    index = 0;
    reading = true;
    startTime = Date.now();
    nextWord();
}

function nextWord() {
    if (!reading) return;
    if (index < words.length - 1) {
        index++;
        render();
        setTimeout(nextWord, 500);
    } else {
        reading = false;
    }
}

function stopReading() {
    reading = false;
}

async function saveSession() {
    let end = Date.now();
    let time = Math.round((end - startTime) / 1000);
    let speed = Math.round(words.length / (time / 60));

    let session = {
        studentName: document.getElementById("studentName").value,
        schoolName: document.getElementById("studentSchool").value,
        grade: document.getElementById("studentGrade").value,
        textTitle: "Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",
        textIndex: 0,
        wordsRead: words.length,
        totalWords: words.length,
        elapsedSeconds: time,
        speed: speed,
        completion: 100,
        date: new Date().toLocaleString()
    };

    await window.ReadingShared.addSession(session);

    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­!");
}
</script>

</body>
</html>
