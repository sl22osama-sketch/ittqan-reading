<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„Ø¥ØªÙ‚Ø§Ù† â€“ Ø§Ù„Ù…Ø¹Ù„Ù…</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script src="firebase-config.js"></script>
<script src="shared_firebase.js"></script>

<style>
body { font-family: "Tajawal"; background:#eef; padding:20px; direction:rtl; text-align:center; }
#studentsBox button { padding:10px; margin:5px; }
</style>
</head>

<body>

<h1>ðŸ“Š Ù…Ù†ØµØ© Ø§Ù„Ù…Ø¹Ù„Ù…</h1>

<h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨:</h3>
<div id="studentsBox"></div>

<h3>Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨:</h3>
<table border="1" width="80%" align="center">
<thead>
<tr>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ø³Ø±Ø¹Ø©</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</th>
</tr>
</thead>
<tbody id="sessionsBody"></tbody>
</table>

<canvas id="speedChart" width="400" height="200"></canvas>

<script>
let chart = null;

async function loadStudents() {
    let list = await window.ReadingShared.getStudents();
    let box = document.getElementById("studentsBox");
    box.innerHTML = "";

    list.forEach(s => {
        let btn = document.createElement("button");
        btn.innerHTML = s.name + " â€“ Ø§Ù„ØµÙ " + s.grade;
        btn.onclick = () => showStudent(s.key);
        box.appendChild(btn);
    });
}

async function showStudent(key) {
    let sessions = await window.ReadingShared.listSessions(key);
    let body = document.getElementById("sessionsBody");
    body.innerHTML = "";

    let dates = [];
    let speeds = [];

    sessions.forEach(s => {
        let tr = document.createElement("tr");
        tr.innerHTML = `
        <td>${s.date}</td>
        <td>${s.speed}</td>
        <td>${s.wordsRead}</td>`;
        body.appendChild(tr);

        dates.push(s.date);
        speeds.push(s.speed);
    });

    // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·
    let ctx = document.getElementById("speedChart").getContext("2d");
    if (chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "line",
        data: {
            labels: dates,
            datasets: [{
                label: "Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",
                data: speeds,
                borderColor: "#6a00ff",
                borderWidth: 3
            }]
        }
    });
}

loadStudents();
</script>

</body>
</html>
